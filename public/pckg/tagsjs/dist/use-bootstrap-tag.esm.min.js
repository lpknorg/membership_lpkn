const T=[];function z(e){for(const t of e.dependencies)t.delete(e);e.dependencies.clear()}function G(e,t){t.add(e),e.dependencies.add(t)}function D(e){const t=new Set;function s(){const o=T[T.length-1];return o&&G(o,t),e}function l(o){e=o;for(const d of[...t])d.execute()}return[s,l]}function N(e){const t={execute(){z(t),T.push(t),e(),T.pop()},dependencies:new Set};t.execute()}function H(e,t){return e.length===t.length&&e.every((s,l)=>s===t[l])}function I(e,t){e.value=t,e.dispatchEvent(new Event("change"))}function J(e,t){const s=e.lastIndexOf(t);s!==-1&&e.splice(s,1)}function m(e,t){const s=document.createElement(e);if(t)for(const l in t)s[l]=t[l];return s}function j(e,t){return typeof e=="string"?e.split(t):Array.isArray(e)?e.flatMap(s=>typeof s=="string"?s.split(t):[]):[]}const B="use-bootstrap-tag",F=`${B}-target`;function K(e){const t=e.nextElementSibling;t&&t.classList.contains(B)&&t.remove();const s=m("div");e.insertAdjacentElement("afterend",s);const l=e.dataset,o={separator:l.ubTagSeparator||",",variant:l.ubTagVariant||"secondary",xPosition:l.ubTagXPosition||"right",transform:l.ubTagTransform||"input => input",isDuplicate:l.ubTagDuplicate!==void 0,max:+l.ubTagMax>0?+l.ubTagMax:void 0},d=()=>s.querySelectorAll("button"),M=n=>{n.classList.add("duplicate"),setTimeout(()=>{n.classList.remove("duplicate")},150)},S=()=>e.value,h=()=>S().split(o.separator).filter(n=>n!==""),V=n=>{const a=h(),c=j(n,o.separator);if(!o.max||a.length<o.max){const r=[];!o.isDuplicate&&a.forEach((i,p)=>c.includes(i)&&r.push(p));const u=[];c.forEach(i=>{a.includes(i)?o.isDuplicate&&u.push(i):u.push(i)}),a.push(...u),H(h(),a)||(I(e,a.join(o.separator)),u.forEach(i=>{const p=d()[a.lastIndexOf(i)],_=p.offsetHeight;p.style.height=0,setTimeout(()=>p.style.height=`${_}px`,0),setTimeout(()=>p.style.removeProperty("height"),150)})),o.isDuplicate||r.forEach(i=>M(d()[i]))}else c.length>0&&d().forEach(M)},$=n=>{const a=h();j(n,o.separator).forEach(r=>J(a,r)),H(h(),a)||I(e,a.join(o.separator))},g=e.classList,E=e.disabled;e.tabIndex=-1,g.add(F);const[P,q]=D(e.value),[O,x]=D(!1),[f,w]=D(""),v=()=>P().split(o.separator).filter(n=>n.trim()!==""),U=()=>Function(`return ${o.transform}`)()(f().trim()),A=()=>v().length?"":e.placeholder;s.className=`${B} d-flex flex-wrap align-items-center gap-1 ${g.value}`.replace(F,""),N(()=>{O()?s.classList.add("focus"):s.classList.remove("focus")});const b=()=>{var n;return(n=s.querySelector("input"))==null?void 0:n.focus()},L=n=>{n>=0&&$(v()[n])},k=(n=!1)=>{const a=U();a===""&&w(""),(f().includes(o.separator)||n&&f()!=="")&&(V(a.split(o.separator).filter(c=>c.trim()!=="")),w(""))},y=m("button",{type:"button",className:`align-items-center gap-1 d-inline-flex py-0 border-0 btn btn-${o.variant}`,disabled:E});g.contains("form-control-sm")&&y.classList.add("btn-sm"),g.contains("form-control-lg")&&y.classList.add("btn-lg"),o.xPosition==="left"&&y.classList.add("flex-row-reverse");const C=m("span",{className:"d-inline-flex",role:"button",tabIndex:-1,innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></svg>'}),X=n=>{d().forEach(a=>a.remove()),n.reverse().forEach((a,c)=>{const r=n.length-1-c,u=y.cloneNode();if(u.innerHTML=a,u.onfocus=()=>{u.classList.add("active"),x(!0)},u.onblur=()=>{u.classList.remove("active"),x(!1)},u.onkeydown=({key:i})=>{if(i==="Backspace"||i==="Delete"){L(r);const p=i==="Backspace"?r-1:v().length===r?-1:r;p===-1?b():d()[p].focus()}},!E){const i=C.cloneNode(!0);i.onclick=()=>{L(r),b()},u.append(i)}s.prepend(u)})};if(N(()=>{X(v())}),!E){const n=m("div",{className:"input-wrapper"}),a=m("span"),c=m("input",{type:"text"});c.onfocus=()=>{x(!0)},c.onblur=()=>{x(!1),k(!0)},c.onkeydown=r=>{f()===""&&r.key==="Backspace"&&L(v().length-1),f()!==""&&r.key==="Enter"&&(k(!0),r.preventDefault())},c.oninput=()=>{w(c.value),k()},N(()=>{a.innerHTML=f()||A()||"i",c.placeholder=A(),c.value=f()}),n.append(a,c),s.append(n)}return s.onclick=n=>{n.target.tagName!=="BUTTON"&&b()},e.addEventListener("change",()=>{q(e.value)}),e.addEventListener("focus",b),{getValue:S,getValues:h,addValue:V,removeValue:$}}export{K as default};
